// Declare the TypeScript for Declaration Merging
// https://www.typescriptlang.org/docs/handbook/declaration-merging.html
// Start the javascript type patching
if (Array.prototype.diff == null) {
    Array.prototype.diff = function (a) {
        return this.filter(function (i) {
            return !(a.indexOf(i) > -1);
        });
    };
}
if (Array.prototype.intersect == null) {
    Array.prototype.intersect = function (a) {
        return this.filter(function (i) {
            return (a.indexOf(i) > -1);
        });
    };
}
if (Array.prototype.remove == null) {
    Array.prototype.remove = function (objectOrArray) {
        if (objectOrArray == null)
            return this;
        if (objectOrArray instanceof Array) {
            return this.diff(objectOrArray);
        }
        else {
            var index = this.indexOf(objectOrArray);
            if (index !== -1)
                this.splice(index, 1);
            return this;
        }
    };
}
if (Array.prototype.add == null) {
    Array.prototype.add = function (objectOrArray) {
        if (objectOrArray == null)
            return this;
        if (objectOrArray instanceof Array) {
            for (var i = 0; i < objectOrArray.length; ++i)
                this.push(objectOrArray[i]);
            return this;
        }
        this.push(objectOrArray);
        return this;
    };
}
if (Array.prototype.equals == null) {
    Array.prototype.equals = function (array) {
        // if the other array is a false value, return
        if (array == null)
            return false;
        // compare lengths - can save a lot of time
        if (this.length !== array.length)
            return false;
        for (var i = 0; i < this.length; i++) {
            // Check if we have nested arrays
            if (this[i] instanceof Array && array[i] instanceof Array) {
                // recurse into the nested arrays
                if (!this[i].compare(array[i]))
                    return false;
            }
            else if (this[i] !== array[i]) {
                // Warning - two different object instances will never be equal: {x:20} !=
                // {x:20}
                return false;
            }
        }
        return true;
    };
}
if (Array.prototype.bubbleSort == null) {
    Array.prototype.bubbleSort = function (compFunc) {
        var self = this;
        function merge(left, right) {
            var result = [];
            while (left.length && right.length) {
                if (compFunc(left[0], right[0]) <= 0) {
                    result.push(left.shift());
                }
                else {
                    result.push(right.shift());
                }
            }
            while (left.length)
                result.push(left.shift());
            while (right.length)
                result.push(right.shift());
            return result;
        }
        if (self.length < 2)
            return self.slice(0, self.length);
        var middle = parseInt((self.length / 2).toString());
        var left = self.slice(0, middle);
        var right = self.slice(middle, self.length);
        return merge(left.bubbleSort(compFunc), right.bubbleSort(compFunc));
    };
}
// ============================================================================
// Array.indexOf prptotype function
// Add if this browser (STUPID IE) doesn't support it
if (Array.prototype.indexOf == null) {
    Array.prototype.indexOf = function (item) {
        var len = this.length >>> 0;
        var from = Number(arguments[1]) || 0;
        from = (from < 0) ? Math.ceil(from) : Math.floor(from);
        if (from < 0)
            from += len;
        for (; from < len; from++) {
            if (from in this && this[from] === item)
                return from;
        }
        return -1;
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVXRpbEFycmF5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiVXRpbEFycmF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlEQUFpRDtBQUNqRCx3RUFBd0U7QUFZeEUscUNBQXFDO0FBRXJDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDL0IsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEdBQUcsVUFBVSxDQUFhO1FBQzFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBTTtZQUMvQixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQztBQUNOLENBQUM7QUFFRCxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3BDLEtBQUssQ0FBQyxTQUFTLENBQUMsU0FBUyxHQUFHLFVBQVUsQ0FBYTtRQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7WUFDMUIsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDO0FBQ04sQ0FBQztBQUVELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDakMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsVUFBVSxhQUErQjtRQUM5RCxFQUFFLENBQUMsQ0FBQyxhQUFhLElBQUksSUFBSSxDQUFDO1lBQ3RCLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFF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O0lBQ2QsQ0FBQyxDQUFDO0FBQ04sQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIERlY2xhcmUgdGhlIFR5cGVTY3JpcHQgZm9yIERlY2xhcmF0aW9uIE1lcmdpbmdcbi8vIGh0dHBzOi8vd3d3LnR5cGVzY3JpcHRsYW5nLm9yZy9kb2NzL2hhbmRib29rL2RlY2xhcmF0aW9uLW1lcmdpbmcuaHRtbFxuXG5pbnRlcmZhY2UgQXJyYXk8VD4ge1xuICAgIGRpZmYoYTogQXJyYXk8VD4pOiBBcnJheTxUPjtcbiAgICBpbnRlcnNlY3QoYTogQXJyYXk8VD4pOiBBcnJheTxUPjtcbiAgICByZW1vdmUoYTogQXJyYXk8VD4gfCBUKTogQXJyYXk8VD47XG4gICAgYWRkKGE6IEFycmF5PFQ+IHwgVCk6IEFycmF5PFQ+O1xuICAgIGVxdWFscyhhcnJheTogQXJyYXk8VD4gIHwgbnVsbCk6IGJvb2xlYW47XG4gICAgYnViYmxlU29ydChjb21wRnVuYzogKGxlZnQ6IFQsIHJpZ2h0OiBUKSA9PiBudW1iZXIpOiBBcnJheTxUPjtcbiAgICBpbmRleE9mKGl0ZW06IFQpOiBudW1iZXIgO1xufVxuXG4vLyBTdGFydCB0aGUgamF2YXNjcmlwdCB0eXBlIHBhdGNoaW5nXG5cbmlmIChBcnJheS5wcm90b3R5cGUuZGlmZiA9PSBudWxsKSB7XG4gICAgQXJyYXkucHJvdG90eXBlLmRpZmYgPSBmdW5jdGlvbiAoYTogQXJyYXk8YW55Pik6IEFycmF5PGFueT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXIoZnVuY3Rpb24gKGk6IGFueSkge1xuICAgICAgICAgICAgcmV0dXJuICEoYS5pbmRleE9mKGkpID4gLTEpO1xuICAgICAgICB9KTtcbiAgICB9O1xufVxuXG5pZiAoQXJyYXkucHJvdG90eXBlLmludGVyc2VjdCA9PSBudWxsKSB7XG4gICAgQXJyYXkucHJvdG90eXBlLmludGVyc2VjdCA9IGZ1bmN0aW9uIChhOiBBcnJheTxhbnk+KTogQXJyYXk8YW55PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbHRlcihmdW5jdGlvbiAoaSkge1xuICAgICAgICAgICAgcmV0dXJuIChhLmluZGV4T2YoaSkgPiAtMSk7XG4gICAgICAgIH0pO1xuICAgIH07XG59XG5cbmlmIChBcnJheS5wcm90b3R5cGUucmVtb3ZlID09IG51bGwpIHtcbiAgICBBcnJheS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKG9iamVjdE9yQXJyYXk6IEFycmF5PGFueT4gfCBhbnkpOiBBcnJheTxhbnk+IHtcbiAgICAgICAgaWYgKG9iamVjdE9yQXJyYXkgPT0gbnVsbClcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuXG4gICAgICAgIGlmIChvYmplY3RPckFycmF5IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRpZmYob2JqZWN0T3JBcnJheSk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBpbmRleCA9IHRoaXMuaW5kZXhPZihvYmplY3RPckFycmF5KTtcbiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpXG4gICAgICAgICAgICAgICAgdGhpcy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5pZiAoQXJyYXkucHJvdG90eXBlLmFkZCA9PSBudWxsKSB7XG4gICAgQXJyYXkucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChvYmplY3RPckFycmF5OiBBcnJheTxhbnk+IHwgYW55KTogQXJyYXk8YW55PiB7XG4gICAgICAgIGlmIChvYmplY3RPckFycmF5ID09IG51bGwpXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcblxuICAgICAgICBpZiAob2JqZWN0T3JBcnJheSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9iamVjdE9yQXJyYXkubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICAgICAgdGhpcy5wdXNoKG9iamVjdE9yQXJyYXlbaV0pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnB1c2gob2JqZWN0T3JBcnJheSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG59XG5cbmlmIChBcnJheS5wcm90b3R5cGUuZXF1YWxzID09IG51bGwpIHtcbiAgICBBcnJheS5wcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gKGFycmF5OiBBcnJheTxhbnk+IHwgbnVsbCk6IGJvb2xlYW4ge1xuICAgICAgICAvLyBpZiB0aGUgb3RoZXIgYXJyYXkgaXMgYSBmYWxzZSB2YWx1ZSwgcmV0dXJuXG4gICAgICAgIGlmIChhcnJheSA9PSBudWxsKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIC8vIGNvbXBhcmUgbGVuZ3RocyAtIGNhbiBzYXZlIGEgbG90IG9mIHRpbWVcbiAgICAgICAgaWYgKHRoaXMubGVuZ3RoICE9PSBhcnJheS5sZW5ndGgpXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiB3ZSBoYXZlIG5lc3RlZCBhcnJheXNcbiAgICAgICAgICAgIGlmICh0aGlzW2ldIGluc3RhbmNlb2YgQXJyYXkgJiYgYXJyYXlbaV0gaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgICAgIC8vIHJlY3Vyc2UgaW50byB0aGUgbmVzdGVkIGFycmF5c1xuICAgICAgICAgICAgICAgIGlmICghdGhpc1tpXS5jb21wYXJlKGFycmF5W2ldKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXNbaV0gIT09IGFycmF5W2ldKSB7XG4gICAgICAgICAgICAgICAgLy8gV2FybmluZyAtIHR3byBkaWZmZXJlbnQgb2JqZWN0IGluc3RhbmNlcyB3aWxsIG5ldmVyIGJlIGVxdWFsOiB7eDoyMH0gIT1cbiAgICAgICAgICAgICAgICAvLyB7eDoyMH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xufVxuXG5pZiAoQXJyYXkucHJvdG90eXBlLmJ1YmJsZVNvcnQgPT0gbnVsbCkge1xuICAgIEFycmF5LnByb3RvdHlwZS5idWJibGVTb3J0ID0gZnVuY3Rpb24gKGNvbXBGdW5jOiAobGVmdDogYW55LCByaWdodDogYW55KSA9PiBudW1iZXIpOiBBcnJheTxhbnk+IHtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuXG4gICAgICAgIGZ1bmN0aW9uIG1lcmdlKGxlZnQsIHJpZ2h0KSB7XG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gW107XG5cbiAgICAgICAgICAgIHdoaWxlIChsZWZ0Lmxlbmd0aCAmJiByaWdodC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoY29tcEZ1bmMobGVmdFswXSwgcmlnaHRbMF0pIDw9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGVmdC5zaGlmdCgpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChyaWdodC5zaGlmdCgpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHdoaWxlIChsZWZ0Lmxlbmd0aClcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaChsZWZ0LnNoaWZ0KCkpO1xuXG4gICAgICAgICAgICB3aGlsZSAocmlnaHQubGVuZ3RoKVxuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHJpZ2h0LnNoaWZ0KCkpO1xuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNlbGYubGVuZ3RoIDwgMilcbiAgICAgICAgICAgIHJldHVybiBzZWxmLnNsaWNlKDAsIHNlbGYubGVuZ3RoKTtcblxuICAgICAgICBsZXQgbWlkZGxlID0gcGFyc2VJbnQoKHNlbGYubGVuZ3RoIC8gMikudG9TdHJpbmcoKSk7XG4gICAgICAgIGxldCBsZWZ0ID0gc2VsZi5zbGljZSgwLCBtaWRkbGUpO1xuICAgICAgICBsZXQgcmlnaHQgPSBzZWxmLnNsaWNlKG1pZGRsZSwgc2VsZi5sZW5ndGgpO1xuXG4gICAgICAgIHJldHVybiBtZXJnZShsZWZ0LmJ1YmJsZVNvcnQoY29tcEZ1bmMpLCByaWdodC5idWJibGVTb3J0KGNvbXBGdW5jKSk7XG4gICAgfTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQXJyYXkuaW5kZXhPZiBwcnB0b3R5cGUgZnVuY3Rpb25cbi8vIEFkZCBpZiB0aGlzIGJyb3dzZXIgKFNUVVBJRCBJRSkgZG9lc24ndCBzdXBwb3J0IGl0XG5cbmlmIChBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9PSBudWxsKSB7XG4gICAgQXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAoaXRlbTogYW55KTogbnVtYmVyIHtcbiAgICAgICAgbGV0IGxlbiA9IHRoaXMubGVuZ3RoID4+PiAwO1xuXG4gICAgICAgIGxldCBmcm9tID0gTnVtYmVyKGFyZ3VtZW50c1sxXSkgfHwgMDtcbiAgICAgICAgZnJvbSA9IChmcm9tIDwgMCkgPyBNYXRoLmNlaWwoZnJvbSkgOiBNYXRoLmZsb29yKGZyb20pO1xuICAgICAgICBpZiAoZnJvbSA8IDApXG4gICAgICAgICAgICBmcm9tICs9IGxlbjtcblxuICAgICAgICBmb3IgKDsgZnJvbSA8IGxlbjsgZnJvbSsrKSB7XG4gICAgICAgICAgICBpZiAoZnJvbSBpbiB0aGlzICYmIHRoaXNbZnJvbV0gPT09IGl0ZW0pXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZyb207XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH07XG59XG4iXX0=